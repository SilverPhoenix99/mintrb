%%{
#%

machine Lex;

EXPR_CLASS := |*

  empty_lines;

  e_beg_sign;

  '/' => StringStart;

  percent_string => StringStart;

  (
      '::'
    | ( '**' | '*' ) %TokEnd [^=]
    | ( '<=>' | '<=' | '<' | '<<' %TokEnd [^=] ) % { @in_cmd = true }
    | '&' %TokEnd [^&.=]
    | '('
    | '['
    | reserved
    | any_ident % { next_state = @in_cmd ? EXPR_CMDARG : EXPR_ARG }

  ) => Keyword;

  any => { fhold; fcall COMMON_EXPR; };

*|;

}%%
#%