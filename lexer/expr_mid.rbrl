%%{
#%

machine Lex;

EXPR_MID := |*

  e_beg_sign;

  heredoc_ident => Heredoc;

  '/' => StringStart;

  percent_string => StringStart;

  '::' => Keyword;

  ( '**' | '*' ) %TokEnd [^=] => Keyword;

  '&' %TokEnd [^&.=] => Keyword;

  '(' => Keyword;

  '[' => Keyword;

  reserved => Keyword;

  any_ident % { next_state = @in_cmd ? EXPR_CMDARG : EXPR_ARG } => Keyword;

  any => { fhold; fcall COMMON_EXPR; };

*|;

}%%
#%